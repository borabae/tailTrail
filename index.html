<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Tail Trail"/>
    <title>Tail Trail</title>
    <link href="styles.css" rel="stylesheet">
</head>

<body>
    <header>
        <img src="tailTrailLogo.png" alt="Tail Trail logo">
        <div class="login-section">
            <a href="#login">Login</a> <!-- Replace #login with the link to your login page -->
            <span> | </span> <!-- Separate login and registration links -->
            <a href="#registration">Register</a> <!-- Replace #registration with the link to your registration page -->
        </div>
    </header>
    
    <nav>
        <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#lost">Report Lost Pet</a></li>
            <li><a href="#found">Report Found Pet</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#petGallery">Gallery</a></li>
            <li><a href="#contact">Contact</a></li>
        </ul>
    </nav>

    <main>
        <section id="home">
            <h2>Welcome to Tail Trail</h2>
            <p>This is where you can report lost or found pets and receive real-time alerts about pets in your area.</p>
        </section>

        <section id="petGallery">
            <div class="gallery-container">
                <h2>Lost Pets</h2>
                <div class="pet-gallery" id="lost-pet-gallery">
                    <img src="https://www.humanesociety.org/sites/default/files/styles/768x326/public/2020/04/guinea-pig-511233.jpg?h=10d202d3&itok=xygPb78l" alt="Lost Pet 1">
                    <img src="https://www.brisbane.qld.gov.au/sites/default/files/images/2020-12/1200x630-keeping-a-cat.jpg" alt="Lost Pet 2">
                    <img src="https://piscespets.com/cdn/shop/articles/e8dda4a92fc37646fe936863a82f2cb6.jpg?v=1623956703" alt="Lost Pet 3">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/George_the_amazing_guinea_pig.jpg/640px-George_the_amazing_guinea_pig.jpg" alt="Lost Pet 4">
                    <img src="https://www.treehugger.com/thmb/pjdyg-LFM8LMjFqQJ_F-ZknClGY=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/things-humans-do-that-dogs-hate-4864319-26-a14e278719804f89a2772fe127676611.jpg" alt="Lost Pet 5">
                    <img src="https://www.avma.org/sites/default/files/media/pet-selection-budgie-with-girl-sm.jpg" alt="Lost Pet 6">
                    <img src="https://myrightbird.com/assets/uploads/mrb-cockatoo-on-arm-e1691150410966-900x887.jpg" alt="Lost Pet 7">
                    <img src="https://diqmdwhttngxa.cloudfront.net/58432/2528/Leah_Sikka-45_3000.jpg" alt="Lost Pet 8">
                    <img src="https://i.redd.it/22bvjvma4c111.jpg" alt="Lost Pet 9">
                    <img src="https://live.staticflickr.com/8680/16582145236_e8bf5975a8_b.jpg" alt="Lost Pet 10">
                </div>
            </div>
            
            <div class="gallery-container">
                <h2>Found Pets</h2>
                <div class="pet-gallery" id="found-pet-gallery">
                    <img src="https://www.thesprucepets.com/thmb/hxWjs7evF2hP1Fb1c1HAvRi_Rw0=/2765x0/filters:no_upscale():strip_icc()/chinese-dog-breeds-4797219-hero-2a1e9c5ed2c54d00aef75b05c5db399c.jpg" alt="Found Pet 1">
                    <img src="https://s3-media0.fl.yelpcdn.com/bphoto/BRmFti85g0XAOsDXkMriew/348s.jpg" alt="Found Pet 2">
                    <img src="https://cdn.rescuegroups.org/6685/pictures/animals/16837/16837676/79189755.jpg" alt="Found Pet 3">
                    <img src="https://wallpapers.com/images/hd/ferret-pink-paw-yj6eu1fw13b8llfj.jpg" alt="Found Pet 4">
                    <img src="https://images.squarespace-cdn.com/content/v1/58b5ecd515d5db7e99645582/1595882789680-CHVWUWQIECRW81N3UZC4/_MG_4139.JPG" alt="Found Pet 5">
                    <img src="https://images.squarespace-cdn.com/content/v1/5c14460a2714e5462b1020d2/1606673849731-59H6ZSBFB9TZSWUXDDUF/LEXI-O.jpg" alt="Found Pet 6">
                    <img src="https://i.dailymail.co.uk/1s/2023/04/21/14/70092619-0-image-a-14_1682084203291.jpg" alt="Found Pet 7">
                    <img src="https://static4.depositphotos.com/1007058/316/i/450/depositphotos_3167621-stock-photo-dwarf-rabbit.jpg" alt="Found Pet 8">
                    <img src="https://www.hachettebookgroup.com/wp-content/uploads/2023/02/SQUARE-Candid_3642612169.jpg" alt="Found Pet 9">
                    <img src="https://www.shutterstock.com/image-photo/jack-russell-terrier-playing-brain-600nw-1932832319.jpg" alt="Found Pet 10">
                </div>
            </div>          
        </section>

        <section id="lost">
            <h2>Report Lost Pet</h2>
            <form id="lostPetForm" action="submit_lost_pet.php" method="post">
                <label for="petName">Pet Name:</label>
                <input type="text" id="petName" name="petName" placeholder="What is your pet's name?" required autocomplete="name">

                <label for="lostPetType">Species:</label>
                <select id="lostPetType" name="petType" placeholder="What is your pet?" required autocomplete="off">
                    <option value="dog">Dog</option>
                    <option value="cat">Cat</option>
                    <option value="bird">Bird</option>
                    <option value="rabbit">Rabbit</option>
                    <option value="guineaPig">Guinea Pig</option>
                    <option value="ferret">Ferret</option>
                </select>

                <label for="lostGender">Gender:</label>
                <select id="lostGender" name="lostGender" placeholder="Is your pet male or female?" required>
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                    <option value="unknown">Unsure</option>
                </select>

                <label for="breed">Breed:</label>
                <select id="breed" name="breed" placeholder="What's your pets' breed?" autocomplete="off"></select>

                <label for="foundColor">Color:</label>
                <input type="text" id="foundColor" name="foundColor" placeholder="What colour is your pet?" required autocomplete="off">

                <label for="lostLocation">Last Known Location:</label>
                <input type="text" id="lostLocation" name="lostLocation" placeholder="Where did you last see your pet?" required autocomplete="off">

                <label for="lostPetImage">Upload Image:</label>
                <input type="file" id="lostPetImage" name="lostPetImage" accept="image/jpeg">
                
                <fieldset class="radio-container" id="contact-method">
                    <legend>Contact Method:</legend>
                    <label for="phone1">Phone</label>
                    <input type="radio" id="phone1" name="contactMethod" value="phone" required autocomplete="off">
                    
                    <label for="email1">Email</label>
                    <input type="radio" id="email1" name="contactMethod" value="email" autocomplete="off">
                    
                    <label for="app1">App</label>
                    <input type="radio" id="app1" name="contactMethod" value="app" autocomplete="off">

                    <label for="contactInfo">Contact Information:</label>
                    <input type="text" id="contactInfo" name="contactInfo" placeholder="Please enter your preferred contact details" required autocomplete="off">
                </fieldset>

                <button type="submit">Submit</button>
            </form>
        </section>

        <section id="found">
            <h2>Report Found Pet</h2>
            <form id="foundPetForm" action="submit_found_pet.php" method="post">
                <label for="foundPetName">Found Pet:</label>
                <input type="text" id="foundPetName" name="foundPetName" placeholder="Does this animal have a nametag? Enter name" autocomplete="name">

                <label for="foundPetType">Species:</label>
                <select id="foundPetType" name="petType" placeholder="What kind of animal did you find?" required autocomplete="off">
                    <option value="dog">Dog</option>
                    <option value="cat">Cat</option>
                    <option value="bird">Bird</option>
                    <option value="rabbit">Rabbit</option>
                    <option value="guineaPig">Guinea Pig</option>
                    <option value="ferret">Ferret</option>
                </select>

                <label for="foundGender">Gender:</label>
                <select id="foundGender" name="foundGender" placeholder="Is the animal male or female?" required>
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                    <option value="unknown">Unsure</option>
                </select>

                <label for="breed">Breed:</label>
                <select id="breed" name="breed" placeholder="Do you know the animal's breed?" autocomplete="off"></select>
                
                <input type="text" id="otherBreedInput" name="otherBreed" style="display: none;" placeholder="Enter other breed">

                <label for="foundColor">Color:</label>
                <input type="text" id="foundColor" name="foundColor" placeholder="What colour is the animal?" required autocomplete="off">

                <label for="foundLocation">Found Location:</label>
                <input type="text" id="foundLocation" name="foundLocation" placeholder="Where did you find the animal?" required autocomplete="off">
                
                <label for="foundPetImage">Upload Image:</label>
                <input type="file" id="foundPetImage" name="foundPetImage" accept="image/jpeg">

                <fieldset class="radio-container" id="contact-method">
                    <legend>Contact Method:</legend>
                    <label for="phone2">Phone</label>
                    <input type="radio" id="phone2" name="contactMethod" value="phone" required autocomplete="off">
                    
                    <label for="email2">Email</label>
                    <input type="radio" id="email2" name="contactMethod" value="email" autocomplete="off">
                    
                    <label for="app2">App</label>
                    <input type="radio" id="app2" name="contactMethod" value="app" autocomplete="off"> 

                    <br>

                    <label for="contactInfo">Contact Information:</label>
                    <input type="text" id="contactInfo" name="contactInfo" placeholder="Please enter your preferred contact details" required autocomplete="off">
                </fieldset>

                <button type="submit">Submit</button>
            </form>

            <?php
            // Database connection details
            $host = 'tail-trail-db.mysql.database.azure.com';
            $db = 'tailtrial';
            $user = 'ericliu';
            $pass = 'Lhy54321..';
            $ssl_ca = 'DigiCertGlobalRootCA.crt.pem';
            
            // Initialize connection
            $conn = mysqli_init();
            if (!$conn) {
                die("mysqli_init failed");
            }
            
            mysqli_ssl_set($conn, NULL, NULL, $ssl_ca, NULL, NULL);
            
            if (!mysqli_real_connect($conn, $host, $user, $pass, $db, 3306, NULL, MYSQLI_CLIENT_SSL)) {
                die('Connect Error (' . mysqli_connect_errno() . ') ' . mysqli_connect_error());
            }
            
            // Handle form submission
            if ($_SERVER["REQUEST_METHOD"] == "POST") {
                // Collect and sanitize form data
                $name = htmlspecialchars($_POST['petName']);
                $species = htmlspecialchars($_POST['lostPetType']);
                $breed = htmlspecialchars($_POST['breed']);
                $color = htmlspecialchars($_POST['color']); 
                $age = intval($_POST['age']); 
                $gender = htmlspecialchars($_POST['gender']); // Assuming you have a gender input field
                $last_seen_location = htmlspecialchars($_POST['lostLocation']);
                $is_found = 0; // Since this form is for lost pets, is_found will always be 0
                $date_reported = date("Y-m-d H:i:s"); // Assuming you want to record the current date and time
            
                // Handle file upload
                $target_dir = "uploads/";
                $target_file = $target_dir . basename($_FILES["photo"]["name"]);
                $uploadOk = 1;
                $imageFileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));
                
                // Check if image file is a actual image or fake image
                $check = getimagesize($_FILES["photo"]["tmp_name"]);
                if($check !== false) {
                    echo "File is an image - " . $check["mime"] . ".";
                    $uploadOk = 1;
                } else {
                    echo "File is not an image.";
                    $uploadOk = 0;
                }
                
                // Check if file already exists
                if (file_exists($target_file)) {
                    echo "Sorry, file already exists.";
                    $uploadOk = 0;
                }
                
                // Check file size
                if ($_FILES["photo"]["size"] > 500000) {
                    echo "Sorry, your file is too large.";
                    $uploadOk = 0;
                }
                
                // Allow certain file formats
                if($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg"
                && $imageFileType != "gif" ) {
                    echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";
                    $uploadOk = 0;
                }
                
                // Check if $uploadOk is set to 0 by an error
                if ($uploadOk == 0) {
                    echo "Sorry, your file was not uploaded.";
                // if everything is ok, try to upload file
                } else {
                    if (move_uploaded_file($_FILES["photo"]["tmp_name"], $target_file)) {
                        echo "The file ". htmlspecialchars( basename( $_FILES["photo"]["name"])). " has been uploaded.";
                        $photo_url = $target_file;
                    } else {
                        echo "Sorry, there was an error uploading your file.";
                    }
                }
            
                $sql = "INSERT INTO pets (name, species, breed, color, age, gender, last_seen_location, is_found, date_reported, photo_url) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
            
                $stmt = $conn->prepare($sql);
                $stmt->bind_param("ssssississ", $name, $species, $breed, $color, $age, $gender, $last_seen_location, $is_found, $date_reported, $photo_url);
            
                if ($stmt->execute()) {
                    echo "<p>New record created successfully</p>";
                } else {
                    echo "<p>Error: " . $stmt->error . "</p>";
                }
            
                $stmt->close();
            }
            
            // Query to fetch all pets
            $sql = "SELECT * FROM pets";
            $result = $conn->query($sql);
            
            if ($result->num_rows > 0) {
                echo "<table><tr><th>Pet ID</th><th>User ID</th><th>Name</th><th>Species</th><th>Breed</th><th>Color</th><th>Age</th><th>Gender</th><th>Last Seen Location</th><th>Is Found</th><th>Date Reported</th><th>Photo</th></tr>";
                while($row = $result->fetch_assoc()) {
                    echo "<tr><td>".$row["pet_id"]."</td><td>".$row["user_id"]."</td><td>".$row["name"]."</td><td>".$row["species"]."</td><td>".$row["breed"]."</td><td>".$row["color"]."</td><td>".$row["age"]."</td><td>".$row["gender"]."</td><td>".$row["last_seen_location"]."</td><td>".($row["is_found"] ? 'Yes' : 'No')."</td><td>".$row["date_reported"]."</td><td><img src='".$row["photo_url"]."' alt='Pet Photo'></td></tr>";
                }
                echo "</table>";
            } else {
                echo "<p>0 results</p>";
            }
            $conn->close();
            ?>
            
        </section>

        <section id="about">
            <h2>About Tail Trail</h2>
            <p>Tail Trail is a lost and found pet alert system that helps reunite lost pets with their owners by providing a platform for reporting lost or found pets and receiving real-time alerts about pets in your area.</p>
        </section>

        <section id="contact">
            <h2>Contact Us</h2>
            <p>If you have any questions or concerns, please contact us at <a href="mailto:info@tailtrail.com">info@tailtrail.com</a>.</p>
        </section>
    </main>

    <footer>
        <p>&copy; Copyright ©2024 BEEA Solutions, Tail Trail® Please reference the Terms and Conditions of Use for specific information. Your use of this website constitutes acceptance of the Terms of Use, Supplemental Terms, Privacy Policy, and Cookie Policy.</p>
    </footer>

    <!-- Popup container -->
    <div id="popup" class="popup">
        <h3>Form Submitted Successfully!</h3>
        <p>Thank you for submitting the form.</p>
        <button onclick="closePopup()">Close</button>
    </div>

    <script src="script.js"></script>

</body>

</html>
